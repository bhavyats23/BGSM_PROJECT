<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQL Editor - Grocery Manager</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f8f9fa;
        font-family: "Segoe UI", system-ui, sans-serif;
      }
      .header {
        background: #4caf50;
        color: white;
      }
      .editor-card {
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      }
      .result-table th {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .result-table {
        border-radius: 12px;
        overflow: hidden;
      }
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1055;
      }
      textarea {
        font-family: "Consolas", monospace;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header py-3 shadow-sm">
      <div class="container d-flex justify-content-between align-items-center">
        <a href="{{ url_for('dashboard') }}" class="text-white fs-3">
          <i class="bi bi-arrow-left-circle-fill"></i>
        </a>
        <h4 class="mb-0 fw-bold">SQL Editor</h4>
        <div></div>
      </div>
    </header>

    <div class="container my-5">
      <div class="editor-card bg-white p-4">
        <h5 class="mb-4 fw-bold text-success">
          <i class="bi bi-terminal-fill me-2"></i> Run SQL Query
        </h5>

        <form method="post">
          <div class="mb-4">
            <textarea
              class="form-control"
              name="sql"
              rows="6"
              placeholder="SELECT * FROM products ORDER BY id DESC;\n-- or INSERT, UPDATE, DELETE..."
              required
              autofocus
            ></textarea>
            <small class="text-muted d-block mt-2">
              Tip: Use SELECT for viewing data, INSERT/UPDATE/DELETE for
              changes.
            </small>
          </div>

          <button type="submit" class="btn btn-success w-100 py-3 fw-bold">
            <i class="bi bi-play-fill me-2"></i> Execute Query
          </button>
        </form>

        <!-- Result / Error -->
        {% if error %}
        <div class="alert alert-danger mt-4">
          <strong>Error:</strong> {{ error }}
        </div>
        {% endif %} {% if query_executed %}
        <div class="mt-5">
          <h6 class="text-muted mb-3">Last Query:</h6>
          <pre class="bg-light p-3 rounded border">{{ query_executed }}</pre>
        </div>
        {% endif %} {% if result %}
        <div class="mt-5">
          <h5 class="text-success mb-3">
            Query Result ({{ result|length }} rows)
          </h5>
          <div class="table-responsive">
            <table class="table table-striped table-hover result-table">
              <thead>
                <tr>
                  {% for key in result[0].keys() %}
                  <th>{{ key }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% for row in result %}
                <tr>
                  {% for value in row.values() %}
                  <td>{{ value }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% elif result == [] %}
        <div class="alert alert-info mt-4">
          Query executed successfully - no rows returned.
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Sidebar (same as other pages) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebar">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title fw-bold">Grocery Manager</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body">
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <a href="{{ url_for('dashboard') }}">Dashboard</a>
          </li>
          <li class="list-group-item">
            <a href="{{ url_for('add_product') }}">Add Product</a>
          </li>
          <li class="list-group-item">
            <a href="{{ url_for('inventory') }}">Inventory</a>
          </li>
          <li class="list-group-item">
            <a href="{{ url_for('sales') }}">Sales</a>
          </li>
          <li class="list-group-item active">
            <a href="{{ url_for('sql_editor') }}">SQL Editor</a>
          </li>
          <li class="list-group-item mt-4">
            <a href="{{ url_for('logout') }}" class="text-danger">Logout</a>
          </li>
        </ul>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
